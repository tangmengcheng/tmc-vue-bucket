{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observe {\n    constructor(data) {\n        // Object.defineProperty只能劫持已存在的属性，对新增属性和删除属性不劫持（为此vue2单独写了一些API来解决$set $delete）\n        this.walk(data) // 遍历对象\n    }\n    walk(data) { // 循环对象 对属性依次劫持\n        // 拿到每个属性，“重新定义”每个属性，导致性能不好\n        Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\n    }\n}\n\n// 闭包（get set方法 都能拿到value）\nexport function defineReactive(target, key, value) { // 属性劫持\n    observe(value) // value可能是对象，递归劫持。对所有的对象属性进行劫持\n    Object.defineProperty(target, key, {\n        get() { // 取值的时候会执行get\n            console.log('取值了')\n            return value\n        },\n        set(newVal) { // 设置值的时候会执行set\n            console.log('设置值了')\n            if (newVal === value) return\n            value = newVal\n        }\n    })\n}\n\nexport function observe(data) {\n    // 对这个data对象进行劫持\n    if (typeof data !== 'object' || data === null) {\n        return // 只对对象进行劫持\n    }\n\n    // 如果一个对象被劫持过了，那就不要再被劫持了（如何判断一个对象是否被劫持过？可以新增一个实例，用实例来判断是否被劫持过）\n    return new Observe(data)\n}","import {\n    observe\n} from \"./observe/index.js\"\n\nexport function initState(vm) {\n    const opts = vm.$options\n    if (opts.data) {\n        initData(vm)\n    }\n}\n\nfunction proxy(vm, target, key) {\n    Object.defineProperty(vm, key, {\n        get() {\n            return vm[target][key] // vm.name === vm._data.name\n        },\n        set(newVal) {\n            vm[target][key] = newVal\n        }\n    })\n}\n\nfunction initData(vm) {\n    let data = vm.$options.data\n    data = typeof data === 'function' ? data.call(vm) : data\n\n    vm._data = data // 在实例上可以获取数据\n\n    // 拿到数据后，要对数据劫持。vue2里采用了一个api, defineProperty\n    observe(data) // 观测数据，单独\n\n    // 将vm._data用vm代理\n    for (let key in data) {\n        proxy(vm, '_data', key)\n    }\n}","import {\n    initState\n} from \"./state\"\n\n// 初始化\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        console.log('options', options)\n        // 在当前的实例上扩展一些属性$options $data...\n        // 为什么要定义这些属性？如果使用使用options的话，在其他扩展方法里拿不到。扩展一些属性，可以通过this拿到这个属性\n        // 为什么属性要以$开头，认为是Vue自己的属性。如果自己在data中用$定义变量，实例上拿不到的\n        const vm = this\n        vm.$options = options // 将用户的选项挂载实例上\n\n        // 初始化状态/数据（Vue中的状态：props、data、computed、methods、watch）\n        initState(vm)\n        // todo...模板编译、创建虚拟dom。。。\n    }\n}\n\n// 状态初始化，和初始化没什么关系，需拆分单独管理\n// function initState(vm) {\n//     const opts = vm.$options\n//     // if (opts.props)\n//     if (opts.data) {\n//         initData(vm)\n//     }\n// }\n// function initData(vm) {\n//     let data = vm.$options.data\n//     // data可以是对象或函数[根使用可以是对象也可以是函数；组件一定是函数]（Vue3解决了，认为都是函数）\n//     data = typeof data === 'function' ? data.call(vm) : data\n//     console.log('data', data)\n// }","// vue源码里没有直接使用class定义一个类。类的特点：将所有的方法都耦合在一起，功能越来越多，很难维护。vue在设计的时候使用构造函数，把扩展的内容挂载到原型上，放到不同的文件中，好维护。\n\nimport {\n    initMixin\n} from \"./init\"\n\nfunction Vue(options) {\n    this._init(options)\n}\n\n// 初始化\ninitMixin(Vue) // 扩展了init方法\n// Vue.prototype._init = function () {\n\n// }\n// 把原型上方法扩展成一个个的函数，通过函数的方式，在其原型上扩展功能\n\nexport default Vue"],"names":["Observe","data","_classCallCheck","walk","_createClass","key","value","Object","keys","forEach","defineReactive","target","observe","defineProperty","get","console","log","set","newVal","_typeof","initState","vm","opts","$options","initData","proxy","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}